services:
  localstack:
    image: localstack/localstack:4.11.1
    ports:
      - "4566:4566"
      - "4510-4559:4510-4559"
    environment:
      - DEBUG=1
      - LAMBDA_DOCKER_FLAGS=-p 127.0.0.1:5050:5050 -e LS_LOG=debug
      - LAMBDA_RUNTIME_ENVIRONMENT_TIMEOUT=300
      # For debugging purposes, uncomment this line.  However, the docker lambda containers will leak disk space.
      # - LAMBDA_REMOVE_CONTAINERS=0
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    healthcheck:
      # add a health check for each service you want to use as they are started lazily
      test: "awslocal s3 ls"
      interval: 60s
      timeout: 10s
      retries: 5
      start_period: 30s
